extends: 
  - ./zalando.oas.rules.yml
  - [spectral:oas, recommended]

documentationUrl: https://refactored-chainsaw-8qmo7ge.pages.github.io/
rules:
  oas3-api-servers: off
  must-have-info-x-api-id: off
  must-always-return-json-objects-as-top-level-data-structures: warn
  should-not-use-api-as-base-path: off

  # MUST Properties must use either snake_case or camelCase consistently.
  # => /docs/spectral-rules/must/must-use-consistent-case-for-property-names.md

  must-use-snake-case-for-property-names: off
  must-use-consistent-case-for-property-names:
    description: Properties must use either snake_case or camelCase consistently.
    severity: error
    message: Property names must be in snake_case or camelCase consistently.
    given: $.paths.*.*[responses,requestBody]..content..schema..properties.*~
    then:
      function: pattern
      functionOptions:
        match: ^[a-z][a-z0-9]+(?:(?:_|[A-Z])[a-z0-9]+)*$

  # MUST Query parameters must use either snake_case or camelCase consistently.
  # => /docs/spectral-rules/must/must-use-consistent-case-for-query-parameters.md

  must-use-snake-case-for-query-parameters: off
  must-use-consistent-case-for-query-parameters:
    description: Query parameters must use either snake_case or camelCase consistently.
    severity: error
    message: Query parameters must be in snake_case or camelCase consistently.
    given: $.paths.*.*.parameters[?(@ && @.in=='query')].name
    then:
      function: pattern
      functionOptions:
        match: ^[a-z][a-z0-9]+(?:(?:_|[A-Z])[a-z0-9]+)*$

  # MUST The `info` object must have an `x-audience` that matches at least one of these values: company-internal, partner-external, premium-external or public-external.
  # => /docs/spectral-rules/must/must-have-info-api-audience.md

  must-provide-api-audience: off
  must-have-info-api-audience:
    given: $.info
    severity: error
    then:
      - function: pattern
        functionOptions:
          match: ^(company-internal|partner-external|premium-external|public-external)$
        field: x-audience
      - function: defined
        field: x-audience
    description: 'The `info` object must have an `x-audience` that matches at least one of these values: company-internal, partner-external, premium-external or public-external.'
    message: Missing or wrong `info.x-audience`, should be one of company-internal, partner-external, premium-external or public-external.

  # MUST The `info` object must have an `x-value-chain` that matches at least one of these values: prevent, detect, analyse, respond, cross-cutting or enabling.
  # => /docs/spectral-rules/must/must-have-info-value-chain.md

  must-have-info-value-chain:
    given: $.info
    severity: error
    then:
      - function: pattern
        functionOptions:
          match: ^(prevent|detect|analyse|respond|cross-cutting|enabling)$
        field: x-value-chain
      - function: defined
        field: x-value-chain
    description: 'The `info` object must have an `x-value-chain` that matches at least one of these values: prevent, detect, analyse, respond, cross-cutting or enabling.'
    message: Missing or wrong `info.x-value-chain`, should be one of prevent, detect, analyse, respond, cross-cutting or enabling.

